# 検証手順

## 事前準備

 * Thunderbirdに、メールを送信可能なアカウントを用意しておく。
 * 例外ドメインとして以下の2つを設定しておく。
   * `internal1.example.com`
   * `internal2.example.com`
 * 確認を行う条件の正規表現を `要確認|緊急` と設定しておく。
 * 確認のため添付ファイルを開く設定をONにしておく。
 * すべての宛先を確認するまで送信ボタンを無効化する設定をONにしておく。
 * 他のアドオンの確認を省略する設定をOFFにしておく。
 * Check and Sendをインストールしておく。

## 検証項目

### そのまま送信されるケース

#### 添付無し

 1. 以下の内容でメールを作成する。
    * 添付を伴わない
    * 件名が`このメールは要確認です`
    * 本文が`このメールは要確認です`
    * Toが`内部 <test@internal1.example.com>`
    * Ccが`内部 <test@internal2.example.com>`
    * Bccが`外部 <test@example.com>`
 2. メールを送信する。
    * 期待される結果：確認されない（Check and Sendによる確認が表示される）。

#### 正規表現にマッチしない

 1. 続けて、テキストファイルを1つ添付する。
 2. 件名と本文を以下の通り変更する。
    * 件名が`このメールは確認不要です`
    * 本文が`このメールは確認不要です`
 3. メールを送信する。
    * 期待される結果：確認されない（Check and Sendによる確認が表示される）。

#### 警告対象の宛先がない

 1. 続けて、件名と本文を以下の通り変更する。
    * 件名が`このメールは要確認です`
    * 本文が`このメールは要確認です`
 2. Bccの宛先を削除する。
 3. メールを送信する。
    * 期待される結果：確認されない（Check and Sendによる確認が表示される）。

### 送信前に警告されるケース

#### 件名がマッチする

 1. 続けて、本文を以下の通り変更する。
    * 本文が`本文です`
 2. Bccとして宛先に `外部 <test@example.com>` を追加する。
 3. メールを送信する。
    * 期待される結果：確認が表示される。

#### 本文がマッチする

 1. 続けて、件名と本文を以下の通り変更する。
    * 件名が`件名です`
    * 本文が`このメールは要確認です`
 2. メールを送信する。
    * 期待される結果：確認が表示される。

#### Toが警告対象である

 1. 続けて、件名を以下の通り変更する。
    * 件名が`このメールは要確認です`
 1. 宛先からTo, Ccを消去し、BccをToに繰り上げて、以下の状態にする。
    * Toが`外部 <test@example.com>`
 2. メールを送信する。
    * 期待される結果：確認が表示される。

#### Ccが警告対象である

 1. 続けて、宛先からTo, Bccを消去し、入力し直して以下の状態にする。
    * Toが`内部 <test@internal1.example.com>`
    * Ccが`外部 <test@example.com>`
 2. メールを送信する。
    * 期待される結果：確認が表示される。

#### Bccが警告対象である

 1. 続けて、Ccの宛先をBccに変更する。
 2. メールを送信する。
    * 期待される結果：確認が表示される。

### 添付ファイルを自動的に開く動作

#### ファイルを自分で添付した場合

 1. 確認のため添付ファイルを開く設定をONにしておく。
 2. 先の検証に続けて、画像ファイルを1つ追加で添付する。
 3. メールを送信する。
    * 期待される結果：添付したテキストファイルと画像ファイルの両方が開かれる。

#### メールを添付として転送した場合

 1. 受信済みのメールを「添付として転送」する。
 2. 件名を`このメールは要確認です`に変更する。
 3. 宛先を`外部 <test@example.com>`にする。
 4. メールを送信する。
    * 期待される結果：添付したメールが開かれる。

#### 添付ファイル有りのメールを受信した物を転送する場合

 1. 自分宛に、テキストファイルと画像ファイルを添付したメールを送信する。
 2. 検証用アカウントでメールを受信する。
 3. メールを本文に含めて転送する。
 4. 件名を`このメールは要確認です`に変更する。
 5. 宛先を`外部 <test@example.com>`にする。
 6. メールを送信する。
    * 期待される結果：添付したファイルがダウンロード指示なしに開かれる。

### 送信確認における送信ボタン

#### 送信ボタンの有効化

 1. 続けて、チェックボックスをチェックする。
    * 期待される結果：送信ボタンが有効化される。
 2. メールを送信する。
    * 期待される結果：確認されない（Check and Sendによる確認が表示される）。

#### 宛先の確認前でも送信ボタンが有効となる設定

 1. すべての宛先を確認するまで送信ボタンを無効化する設定をOFFにしておく。
 2. 以下の内容でメールを作成する。
    * 添付を伴う
    * 件名が`このメールは要確認です`
    * 本文が`このメールは要確認です`
    * Toが`内部 <test@internal1.example.com>`
    * Bccが`外部 <test@example.com>`
 3. メールを送信する。
 4. 確認ダイアログが表示されるので、そのまま「送信」ボタンを押す。
    * 期待される結果：再確認のダイアログが表示される。
 5. 再確認のダイアログを閉じる。
 6. チェックボックスをチェックする。
 7. メールを送信する。
    * 期待される結果：確認されない（Check and Sendによる確認が表示される）。

### 他のアドオンでの確認の省略

 1. 他のアドオンの確認を省略するよう設定しておく。
 2. 以下の内容でメールを作成する。
    * 添付を伴う
    * 件名が`このメールは要確認です`
    * 本文が`このメールは要確認です`
    * Toが`外部 <test@example.com>`
 3. メールを送信する。
 4. 確認ダイアログが表示されるので、すべてのチェックをONにして「送信」ボタンを押す。
    * 期待される結果：Check and Sendによる確認が表示されず、そのまま送信される。




