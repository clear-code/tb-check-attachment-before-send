# 検証手順

## 事前準備

 * Thunderbirdに、メールを送信可能なアカウントを用意しておく。
 * 確認を行う条件の正規表現を `要確認|緊急` と設定しておく。
 * 例外ドメインとして以下の2つを設定しておく。
   * `internal1.example.com`
   * `internal2.example.com`
 * 他のアドオンの確認を省略しないよう設定しておく。
 * すべての宛先を確認するまで送信ボタンを無効化するよう設定しておく。
 * Check and Sendをインストールしておく。

## 検証項目

### そのまま送信されるケース

#### 添付無し

 1. 以下の内容でメールを作成する。
    * 添付を伴わない
    * 件名が`このメールは要確認です`
    * 本文が`このメールは要確認です`
    * Toが`内部 <test@internal1.example.com>`
    * Ccが`内部 <test@internal2.example.com>`
    * Bccが`外部 <test@example.com>`
 2. メールを送信する。
    * 期待される結果：確認されない（Check and Sendによる確認が表示される）。

#### 正規表現にマッチしない

 1. 続けて、何かファイルを添付する。
 2. 件名と本文を以下の通り変更する。
    * 件名が`このメールは確認不要です`
    * 本文が`このメールは確認不要です`
 3. メールを送信する。
    * 期待される結果：確認されない（Check and Sendによる確認が表示される）。

#### 警告対象の宛先がない

 1. 続けて、件名と本文を以下の通り変更する。
    * 件名が`このメールは要確認です`
    * 本文が`このメールは要確認です`
 2. Bccの宛先を削除する。
 3. メールを送信する。
    * 期待される結果：確認されない（Check and Sendによる確認が表示される）。

### 送信前に警告されるケース

#### 件名がマッチする

 1. 続けて、本文を以下の通り変更する。
    * 本文が`本文です`
 2. Bccとして宛先に `外部 <test@example.com>` を追加する。
 3. メールを送信する。
    * 期待される結果：確認が表示される。

#### 本文がマッチする

 1. 続けて、件名と本文を以下の通り変更する。
    * 件名が`件名です`
    * 本文が`このメールは要確認です`
 2. メールを送信する。
    * 期待される結果：確認が表示される。

#### Toが警告対象である

 1. 続けて、件名を以下の通り変更する。
    * 件名が`このメールは要確認です`
 1. 宛先からTo, Ccを消去し、BccをToに繰り上げて、以下の状態にする。
    * Toが`外部 <test@example.com>`
 2. メールを送信する。
    * 期待される結果：確認が表示される。

#### Ccが警告対象である

 1. 続けて、宛先からTo, Bccを消去し、入力し直して以下の状態にする。
    * Toが`内部 <test@internal1.example.com>`
    * Ccが`外部 <test@example.com>`
 2. メールを送信する。
    * 期待される結果：確認が表示される。

#### Bccが警告対象である

 1. 続けて、Ccの宛先をBccに変更する。
 2. メールを送信する。
    * 期待される結果：確認が表示される。

### 送信確認における送信ボタン

#### 送信ボタンの有効化

 1. 続けて、チェックボックスを2つともチェックする。
    * 期待される結果：送信ボタンが有効化される。

#### 宛先の確認前でも送信ボタンが有効となる設定

 1. すべての宛先を確認するまで送信ボタンを無効化する設定をOFFにしておく。
 2. 以下の内容でメールを作成する。
    * 添付を伴う
    * 件名が`このメールは要確認です`
    * 本文が`このメールは要確認です`
    * Toが`内部 <test@internal1.example.com>`
    * Bccが`外部 <test@example.com>`
 3. メールを送信する。
 4. 確認ダイアログが表示されるので、そのまま「送信」ボタンを押す。
 5. 再確認のダイアログが表示されるので、閉じる。
 6. チェックボックスを2つともチェックする。
    * 期待される結果：送信ボタンが2度目で初めて有効化される。

### 他のアドオンでの確認の省略

 1. 他のアドオンの確認を省略するよう設定しておく。
 2. 以下の内容でメールを作成する。
    * 添付を伴う
    * 件名が`このメールは要確認です`
    * 本文が`このメールは要確認です`
    * Toが`外部 <test@example.com>`
 3. メールを送信する。
 4. 確認ダイアログが表示されるので、すべてのチェックをONにして「送信」ボタンを押す。
    * 期待される結果：Check and Sendによる確認が表示されず、そのまま送信される。




